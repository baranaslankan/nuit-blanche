<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/style.css" />
    <title>My Events - Nuit Blanche</title>
  </head>
  <body>
    <header class="header">
      <div class="header-left">
        <button class="menu-btn" id="menuBtn">
          <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>
      </div>
      <div class="header-center">
        <h1 class="header-title">My Events</h1>
      </div>
      <div class="header-right">
        <button class="favorite-btn">
          <svg width="24" height="24" fill="none">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="white" stroke-width="2"/>
          </svg>
        </button>
      </div>
    </header>

    <div class="menu-dropdown" id="menuDropdown">
      <div class="menu-content">
        <nav class="menu-nav">
          <a href="index.html" class="menu-item">Home page</a>
          <a href="#" class="menu-item">Event</a>
          <a href="my-events.html" class="menu-item">Saved Event</a>
          <a href="#" class="menu-item">Schedule Event</a>
        </nav>
      </div>
    </div>

    <main class="main-content">
      <!-- Filter Tabs -->
      <section class="filter-tabs">
        <button class="filter-tab active" data-filter="all">
          <img src="assets/images/calendar.svg" alt="Calendar" width="18" height="20" />
          All
        </button>
        <button class="filter-tab" data-filter="interested">
          <img src="assets/images/heart.svg" alt="Heart" width="18" height="20" />
          Interested
        </button>
        <button class="filter-tab" data-filter="going">
          <img src="assets/images/tic.svg" alt="Check" width="18" height="20" />
          Going
        </button>
      </section>

      <!-- Filter Dropdowns -->
      <section class="filter-dropdowns">
        <div class="filter-dropdown">
          <button class="dropdown-btn">
            Category
            <svg width="16" height="16" fill="currentColor">
              <path d="M4 6l4 4 4-4"/>
            </svg>
          </button>
        </div>
        <div class="filter-dropdown">
          <button class="dropdown-btn">
            Neighborhood
            <svg width="16" height="16" fill="currentColor">
              <path d="M4 6l4 4 4-4"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Events List -->
      <section class="my-events-list" id="myEventsList">
        <div class="no-events-message" id="noEventsMessage">
          <p>No events found. Start by marking events as "Interested" or "Going" on the home page!</p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <button class="footer-button" onclick="window.location.href='index.html'">
        <svg class="footer-icon">
          <use href="assets/images/home.svg" width="24" height="24"></use>
        </svg>
        <span class="footer-text">Home</span>
      </button>
      <button class="footer-button" onclick="window.location.href='exhibits.html'">
        <svg class="footer-icon">
          <use href="assets/images/calendar.svg" width="24" height="24"></use>
        </svg>
        <span class="footer-text">Exhibits</span>
      </button>
      <button class="footer-button active">
        <svg class="footer-icon">
          <use href="assets/images/heart.svg" width="24" height="24"></use>
        </svg>
        <span class="footer-text">My Events</span>
      </button>
      <button class="footer-button">
        <svg class="footer-icon">
          <use href="assets/images/person.svg" width="24" height="24"></use>
        </svg>
        <span class="footer-text">Profile</span>
      </button>
    </footer>
  </body>

  <script>
    // Get saved events from localStorage
    function getSavedEvents() {
      const interested = JSON.parse(localStorage.getItem('interestedEvents') || '[]');
      const going = JSON.parse(localStorage.getItem('goingEvents') || '[]');
      return { interested, going };
    }

    // Render events list
    function renderEvents(filter = 'all') {
      const { interested, going } = getSavedEvents();
      const eventsList = document.getElementById('myEventsList');
      const noEventsMessage = document.getElementById('noEventsMessage');
      
      // Add sample data if no events exist for demo
      if (interested.length === 0 && going.length === 0) {
        const sampleEvents = [
          {
            title: "Balloonscape",
            location: "181 Bay St", 
            date: "Fri, Jul 12 • 7:00 PM",
            image: "assets/images/3.svg",
            crowdStatus: "Not too crowded"
          },
          {
            title: "Electric Fountain",
            location: "380 Queen st",
            date: "Fri, Oct 4 • 7:00 PM", 
            image: "assets/images/electric.svg",
            crowdStatus: "Very crowded"
          },
          {
            title: "Under the Sea",
            location: "The Tech Hub",
            date: "Fri, Oct 4 • 7:00 PM",
            image: "assets/images/sea.svg", 
            crowdStatus: "Not too crowded"
          },
          {
            title: "OVIAS",
            location: "225 Queen",
            date: "Fri, Jul 12 • 7:00 PM",
            image: "assets/images/2.svg",
            crowdStatus: "Not too crowded"
          }
        ];
        
        // Clear and add sample events to localStorage
        localStorage.clear();
        localStorage.setItem('interestedEvents', JSON.stringify([sampleEvents[0], sampleEvents[2], sampleEvents[3]]));
        localStorage.setItem('goingEvents', JSON.stringify([sampleEvents[1], sampleEvents[3]]));
        
        // Reload with sample data
        const newInterested = JSON.parse(localStorage.getItem('interestedEvents') || '[]');
        const newGoing = JSON.parse(localStorage.getItem('goingEvents') || '[]');
        
        let eventsToShow = [];
        if (filter === 'all') {
          eventsToShow = [...newInterested, ...newGoing];
        } else if (filter === 'interested') {
          eventsToShow = newInterested;
        } else if (filter === 'going') {
          eventsToShow = newGoing;
        }
        
        // Remove duplicates
        eventsToShow = eventsToShow.filter((event, index, self) => 
          index === self.findIndex(e => e.title === event.title)
        );
        
        displayEventCards(eventsToShow, newInterested, newGoing);
        return;
      }
      
      let eventsToShow = [];
      
      if (filter === 'all') {
        eventsToShow = [...interested, ...going];
      } else if (filter === 'interested') {
        eventsToShow = interested;
      } else if (filter === 'going') {
        eventsToShow = going;
      }

      // Remove duplicates (events that are both interested and going)
      eventsToShow = eventsToShow.filter((event, index, self) => 
        index === self.findIndex(e => e.title === event.title)
      );

      displayEventCards(eventsToShow, interested, going);
    }
    
    function displayEventCards(eventsToShow, interested, going) {
      const eventsList = document.getElementById('myEventsList');
      const noEventsMessage = document.getElementById('noEventsMessage');

      if (!eventsList) {
        console.error('myEventsList element not found');
        return;
      }

      if (eventsToShow.length === 0) {
        if (noEventsMessage) {
          noEventsMessage.style.display = 'block';
        }
        eventsList.innerHTML = '<div class="no-events-message"><p>No events found. Start by marking events as "Interested" or "Going" on the home page!</p></div>';
        return;
      }

      if (noEventsMessage) {
        noEventsMessage.style.display = 'none';
      }
      
      const eventsHTML = eventsToShow.map(event => {
        const isInterested = interested.some(e => e.title === event.title);
        const isGoing = going.some(e => e.title === event.title);
        
        return `
          <div class="my-event-card">
            <div class="my-event-header">
              <div class="my-event-info">
                <h3 class="my-event-title">${event.title}</h3>
                <div class="my-event-details">
                  <p class="my-event-date">${event.date}</p>
                  <p class="my-event-location">${event.location}</p>
                </div>
                <div class="my-event-status">
                  <div class="live-status">
                    <img src="assets/images/live.svg" alt="Live" />
                    <span>Live update 17min ago</span>
                  </div>
                  <div class="crowd-status ${event.crowdStatus === 'Very crowded' ? 'very-crowded' : ''}">
                    <img src="assets/images/crowd.svg" alt="Crowd" />
                    <span>${event.crowdStatus || 'Not too crowded'}</span>
                  </div>
                </div>
              </div>
              <div class="my-event-image" style="background-image: url('${event.image}')"></div>
            </div>
            <div class="my-event-buttons">
              <button class="event-btn ${isInterested ? 'interested active' : 'interested'}" data-type="interested" data-event='${JSON.stringify(event)}'>
                <img src="assets/images/heart.svg" alt="Heart" class="event-btn-icon" />
                Interested
              </button>
              <button class="event-btn ${isGoing ? 'going active' : 'going'}" data-type="going" data-event='${JSON.stringify(event)}'>
                <img src="assets/images/tic.svg" alt="Check" class="event-btn-icon" />
                Going
              </button>
            </div>
          </div>
        `;
      }).join('');

      eventsList.innerHTML = eventsHTML;

      // Use event delegation for better event handling
      if (eventsList) {
        eventsList.removeEventListener('click', handleEventDelegation);
        eventsList.addEventListener('click', handleEventDelegation);
      }
    }

    // Handle clicks using event delegation
    function handleEventDelegation(e) {
      const button = e.target.closest('.event-btn');
      if (button) {
        handleEventButton(e);
      }
    }

    // Add event listeners to all event buttons
    function addEventListeners() {
      // Event delegation is now used, so this function is not needed
      // but keeping it for compatibility
    }

    // Handle event button clicks
    function handleEventButton(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const button = e.target.closest('.event-btn');
      if (!button) return;
      
      const type = button.getAttribute('data-type');
      const eventData = button.getAttribute('data-event');
      
      if (!type || !eventData) return;
      
      const event = JSON.parse(eventData);
      
      let interested = JSON.parse(localStorage.getItem('interestedEvents') || '[]');
      let going = JSON.parse(localStorage.getItem('goingEvents') || '[]');

      if (type === 'interested') {
        const index = interested.findIndex(e => e.title === event.title);
        if (index > -1) {
          interested.splice(index, 1);
        } else {
          interested.push(event);
        }
        localStorage.setItem('interestedEvents', JSON.stringify(interested));
      } else if (type === 'going') {
        const index = going.findIndex(e => e.title === event.title);
        if (index > -1) {
          going.splice(index, 1);
        } else {
          going.push(event);
        }
        localStorage.setItem('goingEvents', JSON.stringify(going));
      }

      // Re-render events with current filter
      const activeFilter = document.querySelector('.filter-tab.active').getAttribute('data-filter');
      renderEvents(activeFilter);
    }

    // Filter tabs functionality  
    document.addEventListener('DOMContentLoaded', function() {
      // Tab functionality
      document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          const filter = tab.getAttribute('data-filter');
          renderEvents(filter);
        });
      });

      // Hamburger menu functionality
      const menuBtn = document.querySelector('.menu-btn');
      const hamburger = document.querySelector('.hamburger');
      const menu = document.querySelector('.menu-dropdown');

      if (menuBtn) {
        menuBtn.addEventListener('click', () => {
          hamburger.classList.toggle('active');
          
          if (menu.style.display === 'block') {
            menu.style.display = 'none';
          } else {
            menu.style.display = 'block';
          }
        });
      }

      // Initialize page with sample data
      const sampleEvents = [
        {
          title: "Balloonscape",
          location: "181 Bay St", 
          date: "Fri, Jul 12 • 7:00 PM",
          image: "assets/images/3.svg",
          crowdStatus: "Not too crowded"
        },
        {
          title: "Electric Fountain",
          location: "380 Queen st",
          date: "Fri, Oct 4 • 7:00 PM", 
          image: "assets/images/electric.svg",
          crowdStatus: "Very crowded"
        },
        {
          title: "Under the Sea",
          location: "The Tech Hub",
          date: "Fri, Oct 4 • 7:00 PM",
          image: "assets/images/sea.svg", 
          crowdStatus: "Not too crowded"
        },
        {
          title: "OVIAS",
          location: "225 Queen",
          date: "Fri, Jul 12 • 7:00 PM",
          image: "assets/images/2.svg",
          crowdStatus: "Not too crowded"
        }
      ];
      
      // Set sample data for demo
      localStorage.setItem('interestedEvents', JSON.stringify([sampleEvents[0], sampleEvents[2], sampleEvents[3]]));
      localStorage.setItem('goingEvents', JSON.stringify([sampleEvents[1], sampleEvents[3]]));
      
      renderEvents('all');
    });
  </script>
</html>
